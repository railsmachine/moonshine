<% log_prefix = configuration[:mysql][:log_prefix] || Facter.to_hash["hostname"] %>

[client]
default-character-set   = <%= configuration[:mysql][:default_character_set] || 'utf8' %>

[mysqld]
######### storage engine
default-storage-engine  = <%= configuration[:mysql][:default_storage_engine] || 'innodb' %>

######### character sets
character_set_server    = <%= configuration[:mysql][:character_set_server] || 'utf8' %>
collation_server        = <%= configuration[:mysql][:collation_server] || 'utf8_general_ci' %>

######### replication
server-id                = <%= configuration[:mysql][:server_id] || '1' %>
auto-increment-increment = <%= configuration[:mysql][:auto_increment_increment] || '10' %>
auto-increment-offset    = <%= configuration[:mysql][:auto_increment_offset] || configuration[:mysql][:server_id] || '1' %><% if configuration[:mysql][:version] > 5 %>
binlog_format            = mixed<% end %>
log-bin                  = <%= configuration[:mysql][:log_bin] || "#{log_prefix}-bin" %>
log-bin-index            = <%= configuration[:mysql][:log_bin_index] || "#{log_prefix}-bin" %>
relay-log                = <%= configuration[:mysql][:relay_log] || "#{log_prefix}-relay" %>
relay-log-index          = <%= configuration[:mysql][:relay_log_index] || "#{log_prefix}-relay" %>
replicate-same-server-id = <%= configuration[:mysql][:replicate_same_server_id] || '0' %>

######### innodb options
innodb_buffer_pool_size           = <%= configuration[:mysql][:innodb_buffer_pool_size] || '128M' %>
innodb_additional_mem_pool_size   = <%= configuration[:mysql][:innodb_additional_mem_pool_size] || '16M' %>
innodb_data_file_path             = <%= configuration[:mysql][:innodb_data_file_path] || 'ibdata1:10M:autoextend' %>
innodb_file_io_threads            = <%= configuration[:mysql][:innodb_file_io_threads] || '4' %>
innodb_thread_concurrency         = <%= configuration[:mysql][:innodb_thread_concurrency] || '4' %>
innodb_flush_log_at_trx_commit    = <%= configuration[:mysql][:innodb_flush_log_at_trx_commit] || '2' %>
innodb_log_buffer_size            = <%= configuration[:mysql][:innodb_log_buffer_size] || '64M' %>
innodb_log_file_size              = <%= configuration[:mysql][:innodb_log_file_size] || '80M' %>
innodb_log_files_in_group         = <%= configuration[:mysql][:innodb_log_files_in_group] || '3' %>
innodb_file_per_table             = <%= configuration[:mysql][:innodb_file_per_table] || '1' %>
innodb_max_dirty_pages_pct        = <%= configuration[:mysql][:innodb_max_dirty_pages_pct] || '90' %>
innodb_lock_wait_timeout          = <%= configuration[:mysql][:innodb_lock_wait_timeout] || '120' %>

######### general
default-time-zone     = <%= configuration[:mysql][:default_time_zone] || 'SYSTEM' %>
connect_timeout       = <%= configuration[:mysql][:connect_timeout] || '10' %>
back_log              = <%= configuration[:mysql][:back_log] || '50' %>
max_connections       = <%= configuration[:mysql][:max_connections] || '25' %>
max_connect_errors    = <%= configuration[:mysql][:max_connect_errors] || '10' %>
table_cache           = <%= configuration[:mysql][:table_cache] || '2048' %>
max_allowed_packet    = <%= configuration[:mysql][:max_allowed_packet] || '32M' %>
open_files_limit      = <%= configuration[:mysql][:open_files_limit] || '1024' %>
max_heap_table_size   = <%= configuration[:mysql][:max_heap_table_size] || '64M' %>
join_buffer_size      = <%= configuration[:mysql][:join_buffer_size] || '4M' %>
read_buffer_size      = <%= configuration[:mysql][:read_buffer_size] || '4M' %>
sort_buffer_size      = <%= configuration[:mysql][:sort_buffer_size] || '8M' %>
read_rnd_buffer_size  = <%= configuration[:mysql][:read_rnd_buffer_size] || '8M' %>
thread_cache_size     = <%= configuration[:mysql][:thread_cache_size] || '8' %>
thread_concurrency    = <%= configuration[:mysql][:thread_concurrency] || '8' %>
query_cache_size      = <%= configuration[:mysql][:query_cache_size] || '128M' %>
query_cache_limit     = <%= configuration[:mysql][:query_cache_limit] || '2M' %>
thread_stack          = <%= configuration[:mysql][:thread_stack] || '192K' %>
transaction_isolation = <%= configuration[:mysql][:transaction_isolation] || 'READ-COMMITTED' %>
tmp_table_size        = <%= configuration[:mysql][:tmp_table_size] || '128M' %>
tmpdir                = <%= configuration[:mysql][:tmpdir] || '/tmp' %>
<% if configuration[:mysql][:version] > 5 %>
slow_query_log        = <%= configuration[:mysql][:disable_slow_query_log] ? 0 : 1 %>
slow_query_log_file   = <%= configuration[:mysql][:log_slow_queries] || '/var/log/mysql/slow_queries.log' %>
<% else %>
<% unless configuration[:mysql][:disable_slow_query_log] %>
log_slow_queries      = <%= configuration[:mysql][:log_slow_queries] || '/var/log/mysql/slow_queries.log' %>
<% end %>
<% end %>
long_query_time       = <%= configuration[:mysql][:long_query_time] || '5' %>

<%= configuration[:mysql][:extra] %>
